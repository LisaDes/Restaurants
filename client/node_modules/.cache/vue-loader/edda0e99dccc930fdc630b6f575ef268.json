{"remainingRequest":"C:\\Users\\Lily\\Documents\\Cours\\MASTER 1\\WEB\\TP 3\\tp3\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Lily\\Documents\\Cours\\MASTER 1\\WEB\\TP 1\\restaurants\\src\\components\\HelloWorld.vue?vue&type=style&index=0&id=1c9dbb7e&scoped=true&lang=css&","dependencies":[{"path":"C:\\Users\\Lily\\Documents\\Cours\\MASTER 1\\WEB\\TP 1\\restaurants\\src\\components\\HelloWorld.vue","mtime":1631780577144},{"path":"C:\\Users\\Lily\\Documents\\Cours\\MASTER 1\\WEB\\TP 3\\tp3\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Lily\\Documents\\Cours\\MASTER 1\\WEB\\TP 3\\tp3\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\Lily\\Documents\\Cours\\MASTER 1\\WEB\\TP 3\\tp3\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\Lily\\Documents\\Cours\\MASTER 1\\WEB\\TP 3\\tp3\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Lily\\Documents\\Cours\\MASTER 1\\WEB\\TP 3\\tp3\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgpkaXYgewogIG1hcmdpbi1ib3R0b206IDIwcHg7Cn0K"},{"version":3,"sources":["HelloWorld.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8GA;AACA;AACA","file":"HelloWorld.vue","sourceRoot":"../../TP 1/restaurants/src/components","sourcesContent":["<template>\n  <div>\n    <div v-if=\"restaurants.length\">\n      <ol>\n        <ol>\n          <li v-for=\"(restaurant, index) in restaurants\" :key=\"index\">\n            id: {{restaurant.id}}, {{ restaurant.name }} - {{ restaurant.cuisine }}\n            <button @click=\"removeRestaurant(restaurant)\">Remove</button>\n          </li>\n        </ol>\n      </ol>\n      <p>Total: {{ total }}</p>\n    </div>\n    <div v-else>\n      <p> You didn't go anywhere.</p>\n    </div>\n    <hr />\n    <p>New Restaurant:</p>\n    <form v-on:submit.prevent>\n      <div>\n        <input type=\"text\" v-model=\"name\" placeholder=\"Where did you go?\" />\n      </div>\n      <div>\n        <input type=\"text\" v-model=\"cuisine\" placeholder=\"How much is it?\" />\n      </div>\n      <div>\n        <button @click=\"addRestaurant()\">Submit</button>\n      </div>\n    </form>\n  </div>\n</template>\n \n<script>\nimport _ from \"lodash\";\n \nimport { collection, addDoc, doc, deleteDoc, onSnapshot } from \"firebase/firestore\";\n \nexport default {\n  name: \"HelloWorld\",\n  data: () => ({\n    name: \"\",\n    amount: \"\",\n    total: 0,\n    restaurants: [],\n  }),\n  created() {\n    onSnapshot(collection(this.$db, \"restaurants\"), (snapshot) => {\n      snapshot.docChanges().forEach((change) => {\n        console.dir(change.type);\n        console.dir(change.doc.id);\n        console.dir(change.doc.data());\n \n        let r = change.doc.data();\n        let id = change.doc.id;\n        let pos;\n \n        switch (change.type) {\n          case \"added\":\n            r.id = id;\n            this.restaurants.push(r);\n            break;\n          case \"modified\":\n            pos = this.restaurants.findIndex((element) => element.id === id);\n            console.log(\"POS = \" + pos + \" id=\" + id);\n            //console.dir(this.restaurants);\n            r.id = id;\n            this.$set(this.restaurants, pos, r);\n           // this.restaurants[pos] = r; // marche pas, la vue ne se met pas Ã  jour, il faut $set !!\n            break;\n          case \"removed\":\n            console.log(\"removed\")\n            pos = this.restaurants.findIndex((element) => element.id === id);\n            this.restaurants.splice(pos, 1);\n            break;\n        }\n       });\n    });\n  },\n  methods: {\n    async addRestaurant() {\n      try {\n        const docRef = await addDoc(collection(this.$db, \"restaurants\"), {\n          name: this.name,\n          cuisine: this.cuisine,\n          dateCreated: new Date(),\n        });\n        this.cuisine = \"\";\n        this.name = \"\";\n \n        console.log(\"Document written with ID: \", docRef.id);\n      } catch (e) {\n        console.error(\"Error adding document: \", e);\n      }\n    },\n    async removeRestaurant(restaurant) {\n      await deleteDoc(doc(this.$db, \"restaurants\", restaurant.id));\n      console.log('je supprime doc id = ' + restaurant.id)\n    },\n  },\n  watch: {\n    restaurants() {\n      this.total = _.sumBy(this.restaurants, function (restaurant) {\n        return parseFloat(restaurant.amount);\n      });\n    },\n  },\n};\n</script>\n \n<style scoped>\ndiv {\n  margin-bottom: 20px;\n}\n</style>"]}]}