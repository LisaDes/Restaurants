{"remainingRequest":"C:\\Users\\Lily\\Documents\\Cours\\MASTER 1\\WEB\\TP 3\\tp3\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Lily\\Documents\\Cours\\MASTER 1\\WEB\\TP 1\\restaurants\\src\\components\\HelloWorld.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Lily\\Documents\\Cours\\MASTER 1\\WEB\\TP 1\\restaurants\\src\\components\\HelloWorld.vue","mtime":1631780577144},{"path":"C:\\Users\\Lily\\Documents\\Cours\\MASTER 1\\WEB\\TP 3\\tp3\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Lily\\Documents\\Cours\\MASTER 1\\WEB\\TP 3\\tp3\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\Lily\\Documents\\Cours\\MASTER 1\\WEB\\TP 3\\tp3\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Lily\\Documents\\Cours\\MASTER 1\\WEB\\TP 3\\tp3\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBfIGZyb20gImxvZGFzaCI7CiAKaW1wb3J0IHsgY29sbGVjdGlvbiwgYWRkRG9jLCBkb2MsIGRlbGV0ZURvYywgb25TbmFwc2hvdCB9IGZyb20gImZpcmViYXNlL2ZpcmVzdG9yZSI7CiAKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJIZWxsb1dvcmxkIiwKICBkYXRhOiAoKSA9PiAoewogICAgbmFtZTogIiIsCiAgICBhbW91bnQ6ICIiLAogICAgdG90YWw6IDAsCiAgICByZXN0YXVyYW50czogW10sCiAgfSksCiAgY3JlYXRlZCgpIHsKICAgIG9uU25hcHNob3QoY29sbGVjdGlvbih0aGlzLiRkYiwgInJlc3RhdXJhbnRzIiksIChzbmFwc2hvdCkgPT4gewogICAgICBzbmFwc2hvdC5kb2NDaGFuZ2VzKCkuZm9yRWFjaCgoY2hhbmdlKSA9PiB7CiAgICAgICAgY29uc29sZS5kaXIoY2hhbmdlLnR5cGUpOwogICAgICAgIGNvbnNvbGUuZGlyKGNoYW5nZS5kb2MuaWQpOwogICAgICAgIGNvbnNvbGUuZGlyKGNoYW5nZS5kb2MuZGF0YSgpKTsKIAogICAgICAgIGxldCByID0gY2hhbmdlLmRvYy5kYXRhKCk7CiAgICAgICAgbGV0IGlkID0gY2hhbmdlLmRvYy5pZDsKICAgICAgICBsZXQgcG9zOwogCiAgICAgICAgc3dpdGNoIChjaGFuZ2UudHlwZSkgewogICAgICAgICAgY2FzZSAiYWRkZWQiOgogICAgICAgICAgICByLmlkID0gaWQ7CiAgICAgICAgICAgIHRoaXMucmVzdGF1cmFudHMucHVzaChyKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJtb2RpZmllZCI6CiAgICAgICAgICAgIHBvcyA9IHRoaXMucmVzdGF1cmFudHMuZmluZEluZGV4KChlbGVtZW50KSA9PiBlbGVtZW50LmlkID09PSBpZCk7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJQT1MgPSAiICsgcG9zICsgIiBpZD0iICsgaWQpOwogICAgICAgICAgICAvL2NvbnNvbGUuZGlyKHRoaXMucmVzdGF1cmFudHMpOwogICAgICAgICAgICByLmlkID0gaWQ7CiAgICAgICAgICAgIHRoaXMuJHNldCh0aGlzLnJlc3RhdXJhbnRzLCBwb3MsIHIpOwogICAgICAgICAgIC8vIHRoaXMucmVzdGF1cmFudHNbcG9zXSA9IHI7IC8vIG1hcmNoZSBwYXMsIGxhIHZ1ZSBuZSBzZSBtZXQgcGFzIMOgIGpvdXIsIGlsIGZhdXQgJHNldCAhIQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgInJlbW92ZWQiOgogICAgICAgICAgICBjb25zb2xlLmxvZygicmVtb3ZlZCIpCiAgICAgICAgICAgIHBvcyA9IHRoaXMucmVzdGF1cmFudHMuZmluZEluZGV4KChlbGVtZW50KSA9PiBlbGVtZW50LmlkID09PSBpZCk7CiAgICAgICAgICAgIHRoaXMucmVzdGF1cmFudHMuc3BsaWNlKHBvcywgMSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgIH0pOwogICAgfSk7CiAgfSwKICBtZXRob2RzOiB7CiAgICBhc3luYyBhZGRSZXN0YXVyYW50KCkgewogICAgICB0cnkgewogICAgICAgIGNvbnN0IGRvY1JlZiA9IGF3YWl0IGFkZERvYyhjb2xsZWN0aW9uKHRoaXMuJGRiLCAicmVzdGF1cmFudHMiKSwgewogICAgICAgICAgbmFtZTogdGhpcy5uYW1lLAogICAgICAgICAgY3Vpc2luZTogdGhpcy5jdWlzaW5lLAogICAgICAgICAgZGF0ZUNyZWF0ZWQ6IG5ldyBEYXRlKCksCiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5jdWlzaW5lID0gIiI7CiAgICAgICAgdGhpcy5uYW1lID0gIiI7CiAKICAgICAgICBjb25zb2xlLmxvZygiRG9jdW1lbnQgd3JpdHRlbiB3aXRoIElEOiAiLCBkb2NSZWYuaWQpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgYWRkaW5nIGRvY3VtZW50OiAiLCBlKTsKICAgICAgfQogICAgfSwKICAgIGFzeW5jIHJlbW92ZVJlc3RhdXJhbnQocmVzdGF1cmFudCkgewogICAgICBhd2FpdCBkZWxldGVEb2MoZG9jKHRoaXMuJGRiLCAicmVzdGF1cmFudHMiLCByZXN0YXVyYW50LmlkKSk7CiAgICAgIGNvbnNvbGUubG9nKCdqZSBzdXBwcmltZSBkb2MgaWQgPSAnICsgcmVzdGF1cmFudC5pZCkKICAgIH0sCiAgfSwKICB3YXRjaDogewogICAgcmVzdGF1cmFudHMoKSB7CiAgICAgIHRoaXMudG90YWwgPSBfLnN1bUJ5KHRoaXMucmVzdGF1cmFudHMsIGZ1bmN0aW9uIChyZXN0YXVyYW50KSB7CiAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQocmVzdGF1cmFudC5hbW91bnQpOwogICAgICB9KTsKICAgIH0sCiAgfSwKfTsK"},{"version":3,"sources":["HelloWorld.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiCA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"HelloWorld.vue","sourceRoot":"../../TP 1/restaurants/src/components","sourcesContent":["<template>\n  <div>\n    <div v-if=\"restaurants.length\">\n      <ol>\n        <ol>\n          <li v-for=\"(restaurant, index) in restaurants\" :key=\"index\">\n            id: {{restaurant.id}}, {{ restaurant.name }} - {{ restaurant.cuisine }}\n            <button @click=\"removeRestaurant(restaurant)\">Remove</button>\n          </li>\n        </ol>\n      </ol>\n      <p>Total: {{ total }}</p>\n    </div>\n    <div v-else>\n      <p> You didn't go anywhere.</p>\n    </div>\n    <hr />\n    <p>New Restaurant:</p>\n    <form v-on:submit.prevent>\n      <div>\n        <input type=\"text\" v-model=\"name\" placeholder=\"Where did you go?\" />\n      </div>\n      <div>\n        <input type=\"text\" v-model=\"cuisine\" placeholder=\"How much is it?\" />\n      </div>\n      <div>\n        <button @click=\"addRestaurant()\">Submit</button>\n      </div>\n    </form>\n  </div>\n</template>\n \n<script>\nimport _ from \"lodash\";\n \nimport { collection, addDoc, doc, deleteDoc, onSnapshot } from \"firebase/firestore\";\n \nexport default {\n  name: \"HelloWorld\",\n  data: () => ({\n    name: \"\",\n    amount: \"\",\n    total: 0,\n    restaurants: [],\n  }),\n  created() {\n    onSnapshot(collection(this.$db, \"restaurants\"), (snapshot) => {\n      snapshot.docChanges().forEach((change) => {\n        console.dir(change.type);\n        console.dir(change.doc.id);\n        console.dir(change.doc.data());\n \n        let r = change.doc.data();\n        let id = change.doc.id;\n        let pos;\n \n        switch (change.type) {\n          case \"added\":\n            r.id = id;\n            this.restaurants.push(r);\n            break;\n          case \"modified\":\n            pos = this.restaurants.findIndex((element) => element.id === id);\n            console.log(\"POS = \" + pos + \" id=\" + id);\n            //console.dir(this.restaurants);\n            r.id = id;\n            this.$set(this.restaurants, pos, r);\n           // this.restaurants[pos] = r; // marche pas, la vue ne se met pas Ã  jour, il faut $set !!\n            break;\n          case \"removed\":\n            console.log(\"removed\")\n            pos = this.restaurants.findIndex((element) => element.id === id);\n            this.restaurants.splice(pos, 1);\n            break;\n        }\n       });\n    });\n  },\n  methods: {\n    async addRestaurant() {\n      try {\n        const docRef = await addDoc(collection(this.$db, \"restaurants\"), {\n          name: this.name,\n          cuisine: this.cuisine,\n          dateCreated: new Date(),\n        });\n        this.cuisine = \"\";\n        this.name = \"\";\n \n        console.log(\"Document written with ID: \", docRef.id);\n      } catch (e) {\n        console.error(\"Error adding document: \", e);\n      }\n    },\n    async removeRestaurant(restaurant) {\n      await deleteDoc(doc(this.$db, \"restaurants\", restaurant.id));\n      console.log('je supprime doc id = ' + restaurant.id)\n    },\n  },\n  watch: {\n    restaurants() {\n      this.total = _.sumBy(this.restaurants, function (restaurant) {\n        return parseFloat(restaurant.amount);\n      });\n    },\n  },\n};\n</script>\n \n<style scoped>\ndiv {\n  margin-bottom: 20px;\n}\n</style>"]}]}